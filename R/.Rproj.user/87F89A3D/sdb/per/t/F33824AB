{
    "contents" : "library(rstan)\nlibrary(rethinking)\nlibrary(devtools)\ninstall.packages(c(\"Rcpp\",\"RcppEigen\",\"minqa\"))\ninstall_github(\"lme4\",user=\"lme4\")\nlibrary(lme4)\n\nd <- readxl::read_excel(\"../data_untidy/gst_rheo_all.xlsx\", na = \"NA\" ) # read_excel typically gets the col typse better than read.csv\nstr(d)\nd <- as.data.frame(d) # get rid of tbl_df class\n\n# These data come from a total of 122 trials of juvenile green sturgeon rheotaxis (directionality in the face of perceived current).  23 fish underwent four different treatments under four different conditions.  These were:\n\n# condition 1: velocity present (48 of 122 trials)\n# Condition 2: velocity not present (48 of 122 trials)\n# Condition 3: barbels intact (96 of 122 trials)\n# Condition 4: barbels removed (26 of 122 trials)\n\n# Treatment A: optimotor belt placed above experimental tank, no velocity (24 trials)\n# Treatment B: optimotor belt placed below experimental tank, no velocity (24 trials)\n# Treatment L: velocity during the day (light) (24 trials)\n# Treatment D: velocity during the night (dark) (24 trials)\n\n# Condition 1 comprised Treatments A and B (for a total of 48 trials)\n# Condition 2 comprised Treatments L and D (for a total of 48 trials)\n# condition 3 comprised all 4 treatments (for a total of  96 trials)\n# Condition 4 comprised Treatments L and D (for a total of 26 trials).\n\n# ... for the record, I did not design this experiment.\n\n# The goal is to determine which treatment or condition had the greatest influence on positive rheotaxis behavior (orienting nose-first into the current or \"current\").  The results are reflected in the dataset d (loaded above).  Columns correspond to:\nnames(d)\n\n#----------------------------\n# Explanation of data headers\n#----------------------------\n# Trial No: confusingly, these are labeled 1:37.  This is because each \"Trial\" was originally thought of as a cluster of the 4 treatments.\n# Type: denotes whether trial was completed by a fish with barbels in place (\"with\") or with barbels removed (\"without\").\n# Treatment: see Treatments above\n# Order: denotes order (1:4) in which the treatment took place.  This could be important for examining \"learning\" effects.\n# FishID: each fish had an individual ID; some fish were used in more trials than others.\n# TL: total length of the fish\n# FL: fork length of the fish\n# Date: date of trial\n# AcTime_min: acclimation time before trials began\n# JWatcher Time: the total time in minutes of the recorded trial\n# TimePos: total minutes of the trial spent positively rheotactic\n# TimeNon: \" \" \" neutrally rheotactic\n# TimeNeg: \" \" \" negatively rheotactic\n# PropPos: total proportion of the trial spent positively rheotactic\n# PropNon: \" \" \" neutrally rheotactic\n# PropNeg: \" \" \" negatively rheotactic\n# PosToNeg: total count of the times a fish went directly from positive orientation to negative orientation during the trial\n# NegToPos: \" \" \" negative orientation to positive orientation during the trial\n# PosToNegPerMinute: rate per minute of positive to negative rheotactic changes during that trial\n# NegToPosPerMinute: \" \" \" negative to positive rheotactic changes during that trial\n# Reviewer: initials of technician who reviewed the video trial\n# TapeNo: index of tape\n# Notes\n#------------------------------------------\n\n\n# Data exploration\n\nrange(d$PropPos) # response variable.  Includes a single incidence of zero, but no 1s... not exactly \"zero-inflated.\"\nrange(d$TimePos) # includes zero\nhist(d$PropPos, breaks = 15) # \n\n# Statistical Overview\n\n# The histogram of the response variable is not particularly j-shaped; this means it is not necc. a good candidate for the beta-binomial zero-inflated distribution (BEZI), although we could try it.  One possible solution is to log-transform the response variable (PropPos) so that it assumes values on the open unit interval (0, 1).  However, this would modify the real nature of the data and would not allow the direct interpretation of the parameters in terms of the original response. That said, it would perhaps allow for linear regression.  I tried many versions of transforming the data with the help of Neil Willits (Wilcoxin tests, etc).\n\n# Alternatively, we could use logistic regression, which uses weighted least-squares regression.  I believe this is what the cbind() in glm() leads to (?), but I'm not sure what it means for my data - all the treatments have the same number of trials, unless we compare the barbel trials to the regular trials.\n\n# I could also \"winsorize\" the single value of zero in the dataset by adding 0.0001; I seriously doubt this would greatly affect things, but I'm not sure if it's necessary.\n\n#glm() with both binomial and quasibinomial distribution families and a logit link do run.  Modeling PropPos as the response variable supplies glm() with the direct proportions - the binomial liklihood does not fit with this (it will run, but the variance of the observations will be overestimated).  This is why I have supplied the quasibinomial distribution, but I'm not sure what the additional dispersion parameter should be (theta? theta = A + B, which I thought was only a property of the beta distribution... and, cue confusion).  glmer() results in some very odd correlation values, so I am quite positive that I am doing things incorrectly.\n\n# Currently, lme4 does not support the beta-binomial distribution.  The package gamlss does, but I haven't had a chance to look at it yet.\n\n\n# Just in case we want to run any fixed effects models:\nd2 <- d\nd2$vel <- ifelse(d2$Treatment == \"A\" | d2$Treatment==\"B\", 0, 1) # creates dummy variable for velocity\n\n##  Models  ##\n\nattach(d)\nd$PropNonPos <- (1 - d$PropPos) # add column for proportion of non-positive rheotaxis (for fitting glm & glmer)\n\n#-----------------\n#     glms\n#-----------------\ny <- cbind(PropPos, PropNonPos) ## to supply glm() with a matrix of \"successes\" and \"failures\", or the proportion of time spent positively oriented out of the available time in the trial.\n\n\nm1 <- glm( y ~ Treatment + FishID, family = quasibinomial(link = 'logit'))\nm1\nsummary(m1)\n\n## GLM with time in minutes vs. proportions:\n\ny <- cbind(TimePos, JwatcherTime)\nm1.5 <- glm( y ~ Treatment + FishID, family = quasibinomial(link = 'logit'))\nsummary(m1.5)\n\n\n\n#-----------------\n#     glmms\n#-----------------\ny <- cbind(PropPos, PropNonPos)\n\n## GLMM - have to use binomial family, which Ben Bolker only kind of recommends\nm2 <- glmer( y ~ (1 | FishID), family = binomial(link = 'logit'))\nm2\nsummary(m2)\n\nm3<- glmer(y ~ (1 + Treatment) | FishID, family = binomial(link = 'logit'))\nsummary(m3)\n\n\n\n",
    "created" : 1434570119301.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3578527470",
    "id" : "F33824AB",
    "lastKnownWriteTime" : 1434657170,
    "path" : "C:/Users/Myfanwy/Dropbox/GitHubRepos/gst_rheo/R/stats_overview.R",
    "project_path" : "stats_overview.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}