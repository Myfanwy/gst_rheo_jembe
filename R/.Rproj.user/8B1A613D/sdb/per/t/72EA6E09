{
    "collab_server" : "",
    "contents" : "# Building figure 4 - contrasting raw data with repeated samples from the posterior.\nlibrary(rethinking)\nlibrary(rstan)\n## Load Data ##\n#------------------------------------------------------------------------\n# d <- readxl::read_excel(\"../data_untidy/gst_rheo_all.xlsx\", na = \"NA\" )\nd <- read.csv(\"../data_tidy/gst_rheo_all.csv\", stringsAsFactors = FALSE, header = TRUE)\nhead(d)\n\n# Prep Exp 1 Data for visualizing\nd2 <- d[d$Type == \"with\", ] # filter trials from Experiment 1, where barbels were intact. 96 rows.\nd2[d2$PropPos == 0,] <- 0.0001\nrange(d2$PropPos)\n\n# load model data\nload(\"m2NC.Rdata\")\n\n## Panel Plot with Raw Densities as Fig 4.a, Samples from the Posterior as Fig 4.b\n\nextractvalues <- function(data, treatment) {\n  v <- dplyr::filter(data, Treatment == treatment)\n  v <- v$PropPos\n}\n\ntreata <- extractvalues(d2, \"A\")\ntreatb <- extractvalues(d2, \"B\")\ntreatl <- extractvalues(d2, \"L\")\ntreatd <- extractvalues(d2, \"D\")\n\n# Extract Samples from Posterior\npost <- extract.samples(m2NC)\n\npar(mfrow = c(2, 1))\n\nbitmap(\"Fig4.tiff\", res = 300, width = 7840, height = 5512, units = \"px\", type = \"tifflzw\")\npostscript(\"Fig4.eps\", width = 8, height = 8, horizontal = FALSE, onefile = FALSE, paper = \"special\",\n           colormodel = \"cmyk\")\n\ndens(treata, xlim = c(0, 1), ylim = c(0, 5), col = \"black\", adj = 0.7, \n     xlab = \"\", ylab = \"Density\", lwd = 5)\ndens(treatb, col = \"purple\", lwd = 5, add = TRUE, adj = 0.7)\ndens(treatl, lty = 1, lwd = 5, col = \"dodgerblue\", add = TRUE, adj = 0.7)\ndens(treatd, lty = 1, lwd = 5, col = \"orange\", add = TRUE, adj = 0.7)\n# title(\"Density Curves of Treatment from Empirical Observations\")\nlegend(0, 4.75, cex = 1, pt.cex = 1, c(\"Above\", \"Below\", \"Light\", \"Dark\"), lty = c(1, 1,1,1), lwd = c(3,3,3,3), col = c(\"black\", \"purple\", \"dodgerblue\", \"orange\"), bty = \"n\")\ntext(1, 4.8, \"A\", cex = 2)\n\n\n\n\n## Fig 4.b: sample 300 trials in the posterior for each treatment, fixed effects only\nplot(NULL, xlim = c(0, 1) , ylim = c(0, 5) ,\n     xlab = \"Proportion of Time Spent Positively Oriented\", ylab = \"Density\")\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_above[i]), theta = post$theta[i]), add = TRUE,\n         col = col.alpha(\"black\", 0.15), lwd = 2)\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_below[i]), theta = post$theta[i]), add = TRUE,\n         col = col.alpha(\"purple\", 0.2), lwd = 2)\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_light[i]), theta = post$theta[i]), add = TRUE,\n         col = col.alpha(\"dodgerblue\", 0.2), lwd = 2)\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_dark[i]), theta = post$theta[i]), add = TRUE,\n         col = col.alpha(\"orange\", 0.2), lwd = 2)\ntext(1, 4.8, \"B\", cex = 2)\n\ndev.off()\n\nlegend(0.0, 4.75, cex = 1, pt.cex = 1, c(\"Above\", \"Below\", \"Light\", \"Dark\"), lwd = c(1.5, 1.5, 1.5, 1.5), lty = c(1, 1,1,1), col = c(\"black\", \"purple\", \"dodgerblue\", \"orange\"), bty = \"n\")\n\n\n\n\n## Simulating a random fish:\nplot(NULL, xlim = c(0, 1) , ylim = c(0, 6) ,\n     xlab = \"Proportion of Time Spent Positively Oriented\", ylab = \"Density\")\nfor (i in 1:300)\ncurve( dbeta2(x, prob = logistic(post$b_above[i] + rnorm(1,0,post$sigma_fish[i,1])), theta = post$theta[i]), add = TRUE,  col = col.alpha(\"black\", 0.2))\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_below[i] + rnorm(1,0,post$sigma_fish[i,1])), theta = post$theta[i]), add = TRUE,  col = col.alpha(\"purple\", 0.1))\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_light[i] + rnorm(1,0,post$sigma_fish[i,1])), theta = post$theta[i]), add = TRUE,  col = col.alpha(\"dodgerblue\", 0.18))\nfor (i in 1:300)\n  curve( dbeta2(x, prob = logistic(post$b_dark[i] + rnorm(1,0,post$sigma_fish[i,1])), theta = post$theta[i]), add = TRUE,  col = col.alpha(\"orange\", 0.15))\ntitle('Simulating a Random Fish: Repeat Posterior Sampling of m2NC by Treatment', add = TRUE)\nlegend(0.4, 5.75, cex = 1, pt.cex = 1, c(\"Above\", \"Below\", \"Light\", \"Dark\"), lty = c(1, 1,1,1), col = c(\"black\", \"purple\", \"dodgerblue\", \"orange\"), bty = \"n\")\n",
    "created" : 1473702206771.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1182408289",
    "id" : "72EA6E09",
    "lastKnownWriteTime" : 1474668716,
    "last_content_update" : 1474668716958,
    "path" : "~/Dropbox/GitHubRepos/gst_rheo/R/FiguringOutFigure4.R",
    "project_path" : "FiguringOutFigure4.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}